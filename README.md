# VLAN tagger

## Сборка

    mkdir build
    cd build
    cmake ..
    make
    cd ..

## Входные данные и запуск

Запуск VLAN tagger может происходить с разными опциями. Вы можете использовать любую, удобную для Вас.

1. Запуск с файлом конфигурации. При запуске в данном режиме необходимо использовать опцию -f, после которой необходимо указать относительный или абсолютный путь до файла конфигурации. 

Структура: 

    sudo ./vlan-tagger -f <файл_конфигурации>

Пример: 

    sudo ./vlan-tagger -f pool_ip_vlan.conf

Файл концигурации должен иметь следующую структуру:

    <входной_интрефейс> <выходной_интрефейс>
    < ip адрес > < номер vlan >
    < ip адрес > < номер vlan > и т.д.

Пример файла конфигурации: 

    eth0 lo
    192.168.1.1 1
    234.34.64.2 2
    145.176.1.6 3

2. Запуск, где содержания файла концигурации передаются через аргументы CLI. При запуске в данном режиме необходимо использовать три опции: i, o и p. После каждой опции необходимо указать параметр, за который они отвечают. Структура опций и их параметров:

-i <входной интрефейс>
-o <выходной интрефейс>
-p <пул адресов>, где пул адресов - < ip адрес > < номер vlan > и т.д.

Полная структура запуска: 

    sudo ./vlan-tagger -i <входной интрефейс> -o <выходной интрефейс> -p <пул адресов>

Опции с их аргументами могут быть указаны в любом порядке.

Пример:

    sudo ./vlan-tagger -i eth0 -p 234.34.64.2 2 145.176.1.6 3 -o eth1

При данном варианте запуске программа создаст вспомогательный файл конфигурации, для сохранения информации и её использовании после перезапуска системы.

Для получения данной информации в CLI можно использовать -h опцию. 

После запуска входнные данные проверяются на корректность:

    1. Отсутсвие коллизий в пуле адресов
    2. Наличие интерфейсов в системе

## Автотестирование

Программа для автотестирования должна принимать в качестве аргументов такие же интерфейсы как и основной демон. 
Он генерирует фреймы (не теггированный и тегированный для проверки после тегирования) с нужными для корректной проверки данными и отправляет его во входной интрефейс демона. Демон получив пакет тегирует его и отправляет во выходной интрефейс. Программа считывает его с выходного интрефейса демона и сравнивает кадр который она получила и тот, что отправляла, но уже тегированый самой программой. Таких тестов проходит заданное количество раз.

Запуск тестирования: 

    sudo ./autotest -f <файл конфигурации> -с <число генерируемых фреймов>

Демон vlan_tagger должен быть запущен!

## Сообщение об ошибках

Все сообщения об ошибках формируются в syslog файл с помошью демона сообщений syslogd.

Проверить, запущен ли демон сообщений у Вас:

    sudo service rsyslog status

Запустить демона сообщений:

    sudo service rsyslog start

Посмотреть сообщение об ошибках можно, выполнив команду:

    cat /var/log/syslog | grep vlan_tagger

Внимание, в зависимости от дистрибутива, сообщения могут лежать в файле с другим названием (например, /var/log/messages)!

## Завершение работы демона

Для того, чтобы завершить работу демона ему необходимо послать сигнал SIGINT or kill:

    sudo kill (-2 or -SIGINT or -9) PID_of_daemon

Узнать PID демона, если он запущен, можно выполнив запрос:

    ps -ax | grep vlan_tagger